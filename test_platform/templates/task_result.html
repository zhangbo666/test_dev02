{% extends "task_list.html" %}
{% block taskresult %}

<div>

    <h4 class="sub-header">测试结果</h4>

    <div class="table-responsive op">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th class="op">名称</th>
                    <th class="op">错误</th>
                    <th class="op">失败 </th>
                    <th class="op">跳过</th>
                    <th class="op">用例数量</th>
                    <th class="op">时间</th>
                    <th class="op">操作</th>
                </tr>
            </thead>
            <tbody>

                {% for r in results %}

                <tr>
                    <td>{{ r.name }}</td>
                    <td>{{ r.error }}</td>
                    <td>{{ r.failure }}</td>
                    <td>{{ r.skipped }}</td>
                    <td>{{ r.tests }}</td>
                    <td>{{ r.run_time }}</td>
                    <td>

                        <a href="#" style="margin-left:10px;">

                              <i class="glyphicon glyphicon-list-alt">详情</i>

                        </a>

                    </td>

                </tr>

                {% endfor %}

            </tbody>
        </table>
    </div>

</div>

<!--在线引用jquery-->
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<!--在线引用ztree-->
<link href="http://cdn.bootcss.com/zTree.v3/3.5.23/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
<script src="http://cdn.bootcss.com/zTree.v3/3.5.23/js/jquery.ztree.all.js"></script>


<script type="text/javascript">

    function saveFun(){

        //接口任务名称与描述
        let name = $("#task_name").val();
        let desc = $("#describe").val();

        if (name === ""){

            window.alert("任务名称不能为空！");
            return;

        }

        var cases = new Array();

        var treeObj = $.fn.zTree.getZTreeObj("treeDemo");

        var nodes   = treeObj.getCheckedNodes(true);

        console.log("nodes",nodes);

        for (let i=0; i<nodes.length; i++){

            //判断是否为父节点，false：没有父节点、true：有父节点
            if (nodes[i].isParent == false){

                //获取选中节点的值
                console.log("节点id：",nodes[i].id,nodes[i].name);

                cases.push(nodes[i].id);

            }
        }

        console.log("用例列表",cases);

        //将列表转为字符串
        casesStr = JSON.stringify(cases);

        $.post("/testtask/save_task/",{

                task_id:0,
                name:name,
                desc:desc,
                cases:casesStr

            },
            function (resp){

                if (resp.status == 10200){

                    var message = confirm("创建任务成功，返回testtask首页？");

                    if (message == true) {

                        // js alert弹框后跳转链接
                        window.location.replace("/testtask/");

                    }

                    //window.alert("创建任务成功！")
                }

                else if (resp.status == 10102){

                    window.alert("创建任务失败：测试用例未勾选!")
                }
            }
        );

    };


</script>


{% endblock %}
